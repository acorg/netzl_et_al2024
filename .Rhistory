arrange(n) %>%
pull(Country)) %>%
scale_fill_viridis_c(breaks = time_vals,
labels = time_vals,
name = "Date of report") +
geom_text(data = country_count, aes(y = n+0.5, label = n)) +
theme(legend.position = c(0.15, 0.85),
axis.text.x = element_text(angle = 45, hjust = 1)) -> studies_bp
ggsave(file.path(figures_dir, "studies_by_country_bp.png"), studies_bp, dpi = 300, width = 6, height = 7)
country_count %>%
arrange(n) %>%
pull(Country)
rev(country_count %>%
arrange(n) %>%
pull(Country))
studies %>%
mutate(Count = 1) %>%
arrange(standardise_time) %>%
ggplot(aes(x = Country, y = Count)) +
geom_col(aes(fill = standardise_time), color = "white") +
scale_x_discrete(limits = rev(country_count %>%
arrange(n) %>%
pull(Country))) %>%
scale_fill_viridis_c(breaks = time_vals,
labels = time_vals,
name = "Date of report") +
geom_text(data = country_count, aes(y = n+0.5, label = n)) +
theme(legend.position = c(0.15, 0.85),
axis.text.x = element_text(angle = 45, hjust = 1)) -> studies_bp
studies_bp
studies %>%
mutate(Count = 1) %>%
arrange(standardise_time) %>%
ggplot(aes(x = Country, y = Count)) +
geom_col(aes(fill = standardise_time), color = "white") +
scale_fill_viridis_c(breaks = time_vals,
labels = time_vals,
name = "Date of report") +
geom_text(data = country_count, aes(y = n+0.5, label = n)) +
scale_x_discrete(limits = rev(country_count %>%
arrange(n) %>%
pull(Country))) +
theme(legend.position = c(0.15, 0.85),
axis.text.x = element_text(angle = 45, hjust = 1)) -> studies_bp
studies_bp
studies %>%
mutate(Count = 1) %>%
arrange(standardise_time) %>%
ggplot(aes(x = Country, y = Count)) +
geom_col(aes(fill = standardise_time), color = "white") +
scale_fill_viridis_c(breaks = time_vals,
labels = time_vals,
name = "Date of report") +
geom_text(data = country_count, aes(y = n+0.5, label = n)) +
scale_x_discrete(limits = rev(country_count %>%
arrange(n) %>%
pull(Country))) +
theme(legend.position = c(0.85, 0.85),
axis.text.x = element_text(angle = 45, hjust = 1)) -> studies_bp
studies_bp
ggsave(file.path(figures_dir, "studies_by_country_bp.png"), studies_bp, dpi = 300, width = 6, height = 7)
studies %>%
mutate(Count = 1) %>%
arrange(standardise_time) %>%
ggplot(aes(x = Country, y = Count)) +
geom_col(aes(fill = standardise_time), color = "white") +
scale_fill_viridis_c(breaks = time_vals,
labels = time_vals,
name = "Date of report") +
geom_text(data = country_count, aes(y = n+0.5, label = n)) +
scale_x_discrete(limits = rev(country_count %>%
arrange(n) %>%
pull(Country))) +
theme(legend.position = c(0.85, 0.85),
axis.text.x = element_text(angle = 45, hjust = 1)) +
ylab("# Reports") -> studies_bp
ggsave(file.path(figures_dir, "studies_by_country_bp.png"), studies_bp, dpi = 300, width = 6, height = 7)
#-------------------------------------  Read in studies table
studies <- read.csv(file.path(google_sheets_dir, "Netzl et al. - Collected Omicron antigenic data.csv"))
View(studies)
#-------------------------------------  Read in studies table
studies <- read.csv(file.path(google_sheets_dir, "Netzl et al. - Collected Omicron antigenic data.csv")) %>%
select(Study, Sourcelink, Country, year, Number.of.sera, N.female, Sera.detals.long) %>%
unique() %>%
mutate(Country = gsub("The Netherlands", "Netherlands", Country)) %>%
filter(Study != "Moore/Richardson") # not included in analysis as they had BA.4/5
#-------------------------------------  Read in studies table
studies <- read.csv(file.path(google_sheets_dir, "Netzl et al. - Collected Omicron antigenic data.csv")) %>%
select(Study, Sourcelink, Country, year, Number.of.sera, N.female., Sera.detals.long) %>%
unique() %>%
mutate(Country = gsub("The Netherlands", "Netherlands", Country)) %>%
filter(Study != "Moore/Richardson") # not included in analysis as they had BA.4/5
#-------------------------------------  Read in studies table
studies <- read.csv(file.path(google_sheets_dir, "Netzl et al. - Collected Omicron antigenic data.csv")) %>%
select(Study, Sourcelink, Country, year, Number.of.sera, N.female., Sera.details.long) %>%
unique() %>%
mutate(Country = gsub("The Netherlands", "Netherlands", Country)) %>%
filter(Study != "Moore/Richardson") # not included in analysis as they had BA.4/5
studies <- standardise_time_format(studies, add_time_since_first = FALSE)
studies$standardise_time[studies$Study == "HKU"] <- as.Date("2021/12/12")
studies$standardise_time[studies$Study == "Krumbholz"] <- as.Date("2022/03/29")
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
filter(frac_female = N.female./Number.of.sera)
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
mutate(frac_female = N.female./Number.of.sera)
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_point()
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(y_intercept = 0.5, linetype = "dashed") +
geom_point()
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point()
studies_f %>%
ggplot(aes(x = Study, y = frac_female, group = Study)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge())
View(studies_f)
studies_f %>%
ggplot(aes(x = Study, y = frac_female, group = Study)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.4))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(grou = group = Study), position = position_dodge(width = 0.4))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(width = 0.4))
source("~/Documents/smith/labbook/netzl_et_al2024/code/plotting/data_by_sex.R")
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(width = 0.4))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(width = 2))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(width = 2), alpha = 0.6)
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(width = 2), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = "dodge", alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Study), position = "dodge", alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(studies_f)
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Sera.details.long), position = "dodge", alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Sera.details.long), position = "dodge", alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sourcelink), position = "dodge", alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sourcelink), position = position_dodge(width = 2), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = factor(Study), y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sourcelink), position = position_dodge(width = 2), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = factor(Study), y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = factor(Sourcelink)), position = position_dodge(width = 2), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
rm(list = ls())
library(dplyr)
library(tidyverse)
library(ggplot2)
theme_set(theme_bw())
# to suppress NA removal warnings from ggplot
options(warn=-1)
working_dir <- getwd()
utility_dir <- file.path(working_dir, "code", "utility")
data_dir <- file.path(working_dir,'data')
figures_dir <- file.path(working_dir, "figures", "by_sex")
google_sheets_dir <- file.path(data_dir, "google_sheet_tables")
source(file.path(utility_dir,'plot_functions_auto_label.R'))
source(file.path(utility_dir, "plot_over_time_functions.R"))
source(file.path(utility_dir, "prepare_table_for_forest_plots.R"))
#-------------------------------------  Read in studies table
studies <- read.csv(file.path(google_sheets_dir, "Netzl et al. - Collected Omicron antigenic data.csv")) %>%
select(Study, Sourcelink, Country, year, Number.of.sera, N.female., Sera.details.long) %>%
unique() %>%
mutate(Country = gsub("The Netherlands", "Netherlands", Country)) %>%
filter(Study != "Moore/Richardson") # not included in analysis as they had BA.4/5
studies <- standardise_time_format(studies, add_time_since_first = FALSE)
studies$standardise_time[studies$Study == "HKU"] <- as.Date("2021/12/12")
studies$standardise_time[studies$Study == "Krumbholz"] <- as.Date("2022/03/29")
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sourcelink), position = position_dodge(width = 2), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sourcelink), position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study), position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Sera.details.long), position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Sera.details.long), position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Study, color = Sera.details.long), position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Study)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long, color = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long, color = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 1), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long, color = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.6), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.6), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long)) +
# geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.6), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.6), alpha = 0.6) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera)) %>%
group_by(Study) %>%
mutate(mean_frac = mean(frac_female)) %>%
ungroup()
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female, group = Sera.details.long)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(position = position_dodge(width = 0.6), alpha = 0.6) +
geom_line(aes(y = mean_frac)) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
View(studies_f)
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_line(aes(y = mean_frac)) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
#  geom_line(aes(y = mean_frac)) +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_line(aes(y = mean_frac), color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_line(aes(y = mean_frac, group = Study), color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = mean_frac)) +
geom_line()
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = mean_frac, group = Study)) +
geom_line()
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
arrange(mean_frac) %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
arrange(mean_frac) %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
arrange(mean_frac)
studies_f %>%
arrange(mean_frac)
studies_f %>%
arrange(mean_frac) %>%
#  filter(Study == "Krammer") %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f <- studies %>%
filter(!is.na(N.female.)) %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera)) %>%
group_by(Study) %>%
mutate(mean_frac = mean(frac_female)) %>%
ungroup() %>%
arrange(mean_frac)
View(studies_f)
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f$Study <- factor(studies_f$Study, levels = unique(studies_f$Study))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
View(studies_f)
View(studies_f)
studies_f <- studies %>%
filter(!is.na(N.female.))
View(studies_f)
studies_f <- studies %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera)) %>%
filter(!is.na(frac_female)) %>%
group_by(Study) %>%
mutate(mean_frac = mean(frac_female)) %>%
ungroup() %>%
arrange(mean_frac)
studies_f$Study <- factor(studies_f$Study, levels = unique(studies_f$Study))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1)) +
ylab("Fraction of female study particpants")
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1)) +
ylab("Fraction of female subjects")
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1)) +
ylab("Fraction of female subjects") -> p
studies$Study[grep("nch", studies$Study)]
studies$Study[grep("nch", studies$Study)] <- "Münch"
studies_f <- studies %>%
mutate(frac_female = as.numeric(N.female.)/as.numeric(Number.of.sera)) %>%
filter(!is.na(frac_female)) %>%
group_by(Study) %>%
mutate(mean_frac = mean(frac_female)) %>%
ungroup() %>%
arrange(mean_frac)
studies_f$Study <- factor(studies_f$Study, levels = unique(studies_f$Study))
studies_f %>%
ggplot(aes(x = Study, y = frac_female)) +
geom_hline(yintercept = 0.5, linetype = "dashed") +
geom_point(aes(group = Sera.details.long), position = position_dodge(width = 0.6), alpha = 0.6) +
geom_point(aes(y = mean_frac), shape = 21, fill = "transparent", color = "red") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ylim(c(0,1)) +
ylab("Fraction of female subjects") -> p
p
ggsave(file.path(figures_dir, "fraction_of_female.png"), p, dpi = 300, width = 12, height = 5)
