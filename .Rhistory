n1, n2, statistic, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(Variant, `Serum group`)-> titer_wilcox
forest_data_comb %>%
filter(both_assays) %>%
filter(count_n > 1) %>%
filter(shapiro_comb <= 0.05) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
wilcox_test(Titer~standardised_assay) %>%
add_significance() %>%
select("Variant" = `Comparator antigen`,
"Serum group" = standardise_encounters,
"Variable" = .y.,
"Group 1" = group1,
"Group 2" = group2,
n1, n2, statistic, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(Variant, `Serum group`)-> titer_wilcox
View(forest_data_comb)
## ------------ For TITERS melt it so that it is all in one column, and group by Comparator antigen
comp_df <- forest_data_sub_b %>%
mutate(Log2HAg = Log2Omi,
`Comparator antigen` = OmicronVariant)
forest_data_comb <- rbind(comp_df, forest_data_sub_b) %>%
filter(Webplotdigitizer == "n") %>%
select(!OmicronVariant) %>%
select(!Log2Omi) %>%
select(!log_fold_change) %>%
filter(standardised_assay %in% c("LV", "PV")) %>%
filter(!(is.na(Log2HAg))) %>%
unique()
forest_data_comb %>%
group_by(`Comparator antigen`, standardise_encounters, standardised_assay) %>%
mutate(count_n = n()) %>%
ungroup() %>%
filter(`Comparator antigen` %in% c("D614G", "BA.1", "Alpha", "Beta", "Delta")) -> forest_data_comb
forest_data_comb %>%
filter(count_n > 2) %>%
group_by(`Comparator antigen`, standardise_encounters, standardised_assay) %>%
mutate(shapiro_p = shapiro_test(Log2HAg)$p.value) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
mutate(shapiro_comb = min(shapiro_p),
`Titer` = Log2HAg,
both_assays = ("PV" %in% standardised_assay) & ("LV" %in% standardised_assay)) %>%
ungroup() -> forest_data_comb
forest_data_comb %>%
filter(both_assays) %>%
filter(count_n > 1) %>%
filter(shapiro_comb > 0.05) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
t_test(Titer~standardised_assay) %>%
add_significance() %>%
select("Variant" = `Comparator antigen`,
"Serum group" = standardise_encounters,
"Variable" = .y.,
"Group 1" = group1,
"Group 2" = group2,
n1, n2, statistic, df, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(Variant, `Serum group`)-> titer_ttest
forest_data_comb %>%
filter(both_assays) %>%
filter(count_n > 1) %>%
filter(shapiro_comb <= 0.05) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
wilcox_test(Titer~standardised_assay) %>%
add_significance() %>%
select("Variant" = `Comparator antigen`,
"Serum group" = standardise_encounters,
"Variable" = .y.,
"Group 1" = group1,
"Group 2" = group2,
n1, n2, statistic, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(Variant, `Serum group`)-> titer_wilcox
View(titer_ttest)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/summary_tables/assay_type_comparison.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/summary_tables/assay_type_comparison.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/summary_tables/assay_type_comparison.R")
forest_data_comb %>%
filter(both_assays) %>%
filter(count_n > 1) %>%
filter(shapiro_comb > 0.05) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
t_test(Titer~standardised_assay) %>%
add_significance() %>%
select("Variant" = `Comparator antigen`,
"Serum group" = standardise_encounters,
"Variable" = .y.,
"Group 1" = group1,
"Group 2" = group2,
n1, n2, statistic, df, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(p)-> titer_ttest
forest_data_comb %>%
filter(both_assays) %>%
filter(count_n > 1) %>%
filter(shapiro_comb <= 0.05) %>%
group_by(`Comparator antigen`, standardise_encounters) %>%
wilcox_test(Titer~standardised_assay) %>%
add_significance() %>%
select("Variant" = `Comparator antigen`,
"Serum group" = standardise_encounters,
"Variable" = .y.,
"Group 1" = group1,
"Group 2" = group2,
n1, n2, statistic, p,
"Significance" = p.signif) %>%
mutate(Variant = gsub("D614G", "WT", Variant)) %>%
arrange(p)-> titer_wilcox
fc_ttest <- format_stat_table_flex(titer_ttest)
fc_wilcox <- format_stat_table_flex(titer_wilcox)
stat_doc <- officer::read_docx(path = paste0(path_to_save,paste0("/stat_test_assay_FCfromWT.docx")))
stat_doc %>%
officer::body_add_break() %>%
officer::body_add_par("Supplementary Table XX: Assay based statistical comparison of variant GMTs. A t-test was performed to compare pseudovirus (PV) and live virus (LV) assessed fold changes in different serum groups. Normality was checked with a Shapiro Wilks test.") %>%
flextable::body_add_flextable(fc_ttest) %>%
officer::body_add_break() %>%
officer::body_add_par("Supplementary Table XX: Assay based statistical comparison of variant GMTs. A Wilcoxon-test was performed to compare pseudovirus (PV) and live virus (LV) assessed fold changes in different serum groups. Normality was checked with a Shapiro Wilks test.") %>%
flextable::body_add_flextable(fc_wilcox) -> stat_doc
print(stat_doc, target =
paste0(path_to_save,paste0("/stat_test_assay_FCfromWT.docx")))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
169/2
169/2 + 154.61
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/forest_plots.R")
forest_data %>%
select(Sourcelink, standardise_encounters) %>%
unique() %>%
count(standardise_encounters)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
unique()
View(forest_data)
forest_data %>%
mutate(Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell)
forest_data %>%
mutate(Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
unique()
forest_data %>%
mutate(Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique()
forest_data %>%
mutate(Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
length(main_table$Study)
write.csv(main_table, "data/summary_tables/main_table.csv")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/forest_plots.R")
length(unique(forest_data$Study))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/forest_plots.R")
length(unique(forest_data$Study))
length(unique(forest_data$Sourcelink))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
length(main_table$Sourcelink)
length(unique(main_table$Sourcelink))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Chen"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Chen"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
standardise_time_format(forest_data %>% filter(Study == "Chen"), group_not_by_comparator = FALSE)
View(forest_data)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Chen"), group_not_by_comparator = FALSE)
View(forest_data)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Chen"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
forest_data %>%
filter(Study == "HKU") %>%
View()
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
main_table$Time[main_table$Study == "HKU"]
forest_data %>%
mutate(Study = gsub("Suthar (SAVE as publihed)", "Suthar", Study),
Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
main_table$Time[main_table$Study == "HKU"]
main_table$Time
main_table$Time[main_table$Study == "HKU"] <- "2021-12-12"
stop()
write.csv(main_table, "data/summary_tables/main_table.csv")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
View(forest_data)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Protzer"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Protzer"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Protzer"), group_not_by_comparator = FALSE)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/plot_over_time_functions.R")
standardise_time_format(forest_data %>% filter(Study == "Protzer"), group_not_by_comparator = FALSE)
View(standardise_time_format(forest_data %>% filter(Study == "Protzer"), group_not_by_comparator = FALSE))
forest_data <- standardise_time_format(forest_data, group_not_by_comparator = FALSE)
View(forest_data)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
forest_data$Time[forest_data$Study == "HKU"] <- as.Date("2021.12.12")
?as.Date()
forest_data$Time[forest_data$Study == "HKU"] <- as.Date("2021/12/12", "%y/%m/%d")
forest_data %>%
mutate(Study = gsub("Suthar (SAVE as publihed)", "Suthar", Study),
Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
forest_data$standardise_time[forest_data$Study == "HKU"] <- as.Date("2021/12/12", "%y/%m/%d")
forest_data %>%
mutate(Study = gsub("Suthar (SAVE as publihed)", "Suthar", Study),
Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
write.csv(main_table, "data/summary_tables/main_table.csv")
forest_data %>%
mutate(Study = gsub("Suthar \\(SAVE as publihed\\)", "Suthar", Study),
Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
View(main_table)
View(forest_data)
as.Date("2021-12-12", "%y-%m-%d")
as.Date("2021/12/12", "%y/%m/%d")
as.Date("2021/12/12")
forest_data$standardise_time[forest_data$Study == "HKU"] <- as.Date("2021/12/12")
forest_data %>%
mutate(Study = gsub("Suthar \\(SAVE as publihed\\)", "Suthar", Study),
Time = standardise_time,
'Assay type' = standardised_pseudo,
'Cell type' = standardised_cell) %>%
select(Study, Sourcelink, Time, `Assay type`, `Cell type`) %>%
arrange(Time) %>%
unique() -> main_table
View(main_table)
duplicated(main_table)
main_table %>%
filter(Study == "Wang")
main_table %>%
filter(Study == "Wang") %>%
duplicated()
main_table %>%
filter(Study == "Wang") %>%
unique()
main_table %>%
filter(Study == "Wang") -> wangs
unique(wangs$Sourcelink)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/utility/prepare_table_for_forest_plots.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
wangs
write.csv(main_table, "data/summary_tables/main_table.csv")
length(unique(main_table$Sourcelink))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
View(main_table)
View(forest_data)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
View(main_table)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
745/31
24*7
745/30
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
titers
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
forest_data_titer %>%
filter(standardise_encounters == "Vax + BA.1") %>%
filter(`Comparator antigen` == "D614G") %>%
filter(OmicronVariant == "BA.1") %>%
View()
forest_data_titer %>%
filter(standardise_encounters == "Vax + BA.1") %>%
filter(`Comparator antigen` == "D614G") %>%
filter(OmicronVariant == "BA.1") %>%
ggplot(aes(x = mean_days, y = Log2Omi)) +
geom_point(color = "red") +
geom_point(aes(y = Log2HAg), color = "blue")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_since_exposure.R")
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, Log2HAg, Log2Omi)
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, Log2HAg, Log2Omi) %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, Log2HAg, Log2Omi) %>%
unique() %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, TitersHAg, TitersOmi) %>%
unique() %>%
View()
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, TitersHAg, TitersOmi) %>%
unique() %>%
View()
View(forest_data)
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, TitersHAg, TitersOmicron) %>%
unique() %>%
View()
forest_data %>%
select(all_of(c("Comparator antigen", "OmicronVariant", "Sera_details_no_time", "Log2HAg", "Log2Omi",
"Standardised_sera_names", "standardise_encounters", "vacc_type_het", "vacc_type","vaccine_manufacturer", "standardised_assay", "standardised_pseudo",
"log_fold_change", "mean_days"))) %>%
mutate(shape = "sample") %>%
mutate(`Comparator antigen` = gsub("WT", "D614G", `Comparator antigen`)) %>%
mutate(log_fold_change = -log_fold_change) %>%
filter(!is.na(mean_days)) -> forest_data_sub
forest_data_sub %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
select(Study, Sourcelink, log_fold_change, TitersHAg, TitersOmicron) %>%
unique() %>%
View()
forest_data_sub %>%
filter(standardise_encounters == "2x Vax") %>%
arrange(log_fold_change) %>%
mutate(log_fold_change = 2^log_fold_change) %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
# select(Study, Sourcelink, log_fold_change, TitersHAg, TitersOmicron) %>%
unique() %>%
View()
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/titer_data_over_time_lowess.R")
forest_data %>%
filter(!is.na(standardise_time)) %>%
select(all_of(c("standardise_time", "Webplotdigitizer", "first_record", "time_since_first", "Comparator antigen", "OmicronVariant", "Sera_details_no_time", "Log2HAg", "Log2Omi",
"Standardised_sera_names", "standardise_encounters", "vacc_type_het", "vacc_type","vaccine_manufacturer", "standardised_assay", "standardised_pseudo"))) %>%
mutate(shape = "sample") %>%
mutate(`Comparator antigen` = gsub("WT", "D614G", `Comparator antigen`)) -> forest_data_sub
# now make it long, i.e. titers per variant long
forest_data_sub <- rbind(forest_data_sub %>%
mutate(log_fold_change = Log2Omi),
forest_data_sub %>%
filter(OmicronVariant == "BA.1") %>% # necessary otherwise double entries in case of more than one OmicronVariant
mutate(log_fold_change = Log2HAg,
OmicronVariant = `Comparator antigen`)) %>%
filter(!is.na(log_fold_change)) %>%
select(!Log2HAg) %>%
select(!Log2Omi) %>%
unique()
unique(forest_data$Webplotdigitizer)
unique(as.character(forest_data$Webplotdigitizer))
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_over_time_lowess.R")
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_over_time_lowess.R")
for(comp_ag in c("D614G", "Delta")) {
if(comp_ag == "D614G"){
target_sr_groups <- c("WT conv","2x Vax", "3x Vax", "Vax + BA.1")
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44) , comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44),
omicron_variant_levels = c("BA.1"), show_loess = FALSE)
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means,
omicron_variant_levels = c("BA.1"), show_loess = FALSE)
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_cumMean_44d_fc.", fileext)), lowess, dpi = 300, width = 7, height = 3)
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_cumMean_long_fc.", fileext)), lowess_long, dpi = 300, width = 7, height = 3)
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44) , comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44),
omicron_variant_levels = c("BA.1"), show_loess = FALSE, cum_means_long = cum_means)
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means,
omicron_variant_levels = c("BA.1"), show_loess = FALSE, cum_means_long = cum_means)
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_cumMean_44d_toLong_fc.", fileext)), lowess, dpi = 300, width = 7, height = 3)
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_cumMean_long_toLong_fc.", fileext)), lowess_long, dpi = 300, width = 7, height = 3)
if(do_loess){
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44) , comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44),
omicron_variant_levels = c("BA.1"))
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means,
omicron_variant_levels = c("BA.1"))
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_lowess_44d_fc.", fileext)), lowess, dpi = 300, width = 7, height = 3)
ggsave(file.path(path_to_save, paste0(comp_ag, "_sub_lowess_long_fc.", fileext)), lowess_long, dpi = 300, width = 7, height = 3)
}
}
# Do it here for all sr groups
target_sr_groups <- c("Vax + BA.2", "Vax + BA.1", "Vax + Inf", "Inf + Vax", "3x Vax", "2x Vax", "WT conv")
# show only cumulative mean
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44), comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44), show_loess = FALSE)
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means, show_loess = FALSE)
ggsave(file.path(path_to_save, paste0(comp_ag, "_cumMean_44d_fc.", fileext)), lowess, dpi = 300, width = 13, height = 9)
ggsave(file.path(path_to_save, paste0(comp_ag, "_cumMean_long_fc.", fileext)), lowess_long, dpi = 300, width = 13, height = 9)
if(do_loess){
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44), comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44))
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means)
ggsave(file.path(path_to_save, paste0(comp_ag, "_lowess_44d_fc.", fileext)), lowess, dpi = 300, width = 13, height = 9)
ggsave(file.path(path_to_save, paste0(comp_ag, "_lowess_long_fc.", fileext)), lowess_long, dpi = 300, width = 13, height = 9)
}
# show cumulative + linear regression
if(do_lin){
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44), comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44), show_loess = FALSE,
show_linear = TRUE)
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means, show_loess = FALSE, show_linear = TRUE)
ggsave(file.path(path_to_save, paste0(comp_ag, "_cumMean_lin_44d_fc.", fileext)), lowess, dpi = 300, width = 13, height = 9)
ggsave(file.path(path_to_save, paste0(comp_ag, "_cumMean_lin_long_fc.", fileext)), lowess_long, dpi = 300, width = 13, height = 9)
}
if(do_all_reg){
# show all three together
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44), comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44), show_loess = TRUE,
show_linear = TRUE)
lowess_long <- plot_over_time_lowess(forest_data_sub, comp_ag, target_sr_groups, ymax = 1, ymin = -8,
span = 0.75, cum_means = cum_means, show_loess = TRUE, show_linear = TRUE)
ggsave(file.path(path_to_save, paste0(comp_ag, "_reg3_44d_fc.", fileext)), lowess, dpi = 300, width = 13, height = 9)
ggsave(file.path(path_to_save, paste0(comp_ag, "_reg3_long_fc.", fileext)), lowess_long, dpi = 300, width = 13, height = 9)
}
}
lowess <- plot_over_time_lowess(forest_data_sub %>% filter(time_since_first < 44) , comp_ag, target_sr_groups, ymax = 0.5, ymin = -7,
span = 0.75, cum_means = cum_means %>% filter(time_since_first < 44),
omicron_variant_levels = c("BA.1"), show_loess = FALSE)
length(unique(main_table$Sourcelink))
View(main_table)
source("~/Documents/smith/labbook/netzl-tureli-etal/code/plotting/data_over_time_lowess.R")
forest_data %>%
filter(standardise_encounters == "2x Vax") %>%
filter(`Comparator antigen` %in% c("D614G", "WT")) %>%
filter(OmicronVariant == "BA.1") %>%
arrange(log_fold_change) %>%
mutate(fc = 2^log_fold_change) %>%
select(Study, fc, TitersHAg, TitersOmicron) %>%
unique() %>%
View()
source("~/Documents/smith/labbook/netzl_et_al2024/code/summary_tables/gmt_fc_table_updated.R")
